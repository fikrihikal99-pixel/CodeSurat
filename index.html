<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>PEMBUATAN NOMOR SURAT â€” SDN CILUAR 1</title>
  <style>
    :root{ --bg:#f7fafc; --card:#ffffff; --accent:#2563eb; --muted:#6b7280; --radius:10px; --danger:#ef4444; }
    body{ margin:0; font-family:Inter, "Segoe UI", Roboto, Arial; background:var(--bg); color:#0f172a; padding:20px; }
    .container{ max-width:1040px; margin:0 auto; }
    .card{ background:var(--card); border-radius:12px; padding:18px; box-shadow:0 6px 20px rgba(15,23,42,0.06); margin-bottom:16px; }
    h1{ margin:0 0 6px 0; font-size:18px; }
    p.lead{ margin:0 0 12px 0; color:var(--muted); font-size:13px; }
    label{ display:block; font-weight:600; margin-top:10px; font-size:13px; }
    .flex{ display:flex; gap:12px; align-items:center; }
    .row{ display:flex; gap:12px; margin-top:8px; flex-wrap:wrap; }
    input, select, textarea{ width:100%; padding:8px 10px; border-radius:8px; border:1px solid #e6e9ef; font-size:14px; box-sizing:border-box; background:white; }
    .btn{ border:0; padding:10px 15px; border-radius:8px; cursor:pointer; font-weight:700; transition:0.2s; }
    .btn-primary{ background:var(--accent); color:white; }
    .btn-ghost{ background:#eef2ff; color:var(--accent); }
    .btn-danger{ background:#fee2e2; color:var(--danger); font-size: 11px; padding: 5px 10px; }
    .nbtn{ width:38px; height:38px; border-radius:8px; border:0; background:var(--accent); color:white; font-size:18px; cursor:pointer; }
    .kode-list{ max-height:250px; overflow-y:auto; border:1px solid #eef2ff; border-radius:8px; padding:6px; background:#fff; margin-top:5px;}
    .kode-item{ padding:8px; border-radius:6px; cursor:pointer; font-size:13px; margin-bottom:2px; border: 1px solid transparent; }
    .kode-item:hover{ background:#f8fafc; border-color: #e2e8f0; }
    .kode-selected{ background:#eef2ff; border-left:4px solid var(--accent); font-weight:bold; }
    .preview{ margin-top:12px; padding:15px; border-radius:8px; background:#0f172a; color:white; font-family:Georgia, serif; border: 1px solid #334155; }
    textarea#hasil{ height:60px; margin-top:8px; font-weight:bold; color:var(--accent); font-size: 16px; text-align: center; }
    .history-item{ background:#fff; border:1px solid #eef2ff; padding:12px; border-radius:8px; display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:8px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
    .tiny{ font-size:11px; color:var(--muted); }
    .perihal-text { color: var(--accent); font-weight: 600; font-size: 12px; margin-top: 2px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>PEMBUATAN NOMOR SURAT SDN CILUAR 1</h1>
      <p class="lead">Pilih kode, isi perihal, dan simpan secara otomatis ke riwayat.</p>

      <label> Cari & Pilih Kode Surat</label>
      <input id="searchKode" type="text" placeholder="Ketik kode atau nama (misal: 421 atau Guru)..." onkeyup="filterKode()"/>
      <div id="kodeList" class="kode-list"></div>

      <div class="row">
        <div style="width:180px;">
          <label> Nomor Urut</label>
          <div class="flex">
            <button onclick="adjustNomor(-1)" class="nbtn">âˆ’</button>
            <input id="nomorInput" type="number" min="1" value="1" style="text-align:center;"/>
            <button onclick="adjustNomor(1)" class="nbtn">+</button>
          </div>
        </div>
        <div style="flex:1;">
          <label> Sekolah</label>
          <select id="sekolahSelect">
            <option value="SDNCIL1">SDNCIL1</option>
            <option value="LAINNYA">Manual...</option>
          </select>
        </div>
        <div style="width:120px;"><label> Bulan</label><select id="bulanSelect"></select></div>
        <div style="width:120px;"><label> Tahun</label><input id="tahunInput" type="number"/></div>
      </div>

      <label> Keterangan / Perihal Surat</label>
      <input id="keteranganInput" type="text" placeholder="Contoh: Undangan Rapat Orang Tua, SK Pembagian Tugas..."/>

      <div class="flex" style="margin-top:20px;">
        <button id="generateBtn" class="btn btn-primary" style="flex:2">GENERATE & SIMPAN ONLINE</button>
        <button id="copyBtn" class="btn btn-ghost" style="flex:1">Salin Nomor</button>
      </div>

      <textarea id="hasil" readonly placeholder="Hasil nomor akan muncul di sini..."></textarea>
      
      <div class="preview" id="previewArea" style="display:none;">
        <div style="text-align:center; font-size:14px;">
          <strong style="color: #94a3b8; font-size: 10px;">PRATINJAU FORMAT</strong><br>
          <span id="previewNo" style="font-size: 16px; display: block; margin: 5px 0;"></span>
          <span id="previewKet" style="font-style: italic; color: #cbd5e1;"></span>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="flex" style="justify-content:space-between; margin-bottom: 15px;">
        <h2 style="font-size:16px; margin:0;">Riwayat Penggunaan</h2>
        <div class="flex">
          <button onclick="loadOnline()" id="btnOnline" class="btn btn-ghost" style="font-size:12px; padding: 5px 10px;">ðŸ”„ Sinkron Online</button>
          <button onclick="clearAllHistory()" class="btn btn-danger">Hapus Semua</button>
        </div>
      </div>
      <div style="margin-bottom: 15px;">
        <label>Nama Pembuat (Identitas di Sheet)</label>
        <input id="pembuatInput" type="text" placeholder="Nama Anda" style="font-size:12px;"/>
      </div>
      <div id="historyContainer"></div>
    </div>
  </div>

  <script>
    const $ = id => document.getElementById(id);
    const API_URL = "https://script.google.com/macros/s/AKfycbx_us6kcd6rAIk8YjIhxpysE6ru8yYc6YZwdR2XhjCRVjDBWoiQZor9-S1zWRGHkFyjNQ/exec";
    const DB_NAME = 'surat_db_ciluar1';

    // DATABASE KODE LENGKAP
    const kodeData = [
      // ======================== 000 ========================
      { kode: "000", ket: "Urusan Umum" },
      { kode: "000.1", ket: "Ketatausahaan" },
      { kode: "000.1.1", ket: "Persuratan / Tata Naskah Dinas" },
      { kode: "000.1.2", ket: "Pengelolaan Surat Masuk dan Keluar" },
      { kode: "000.1.3", ket: "Pengelolaan Buku Agenda" },
      { kode: "000.1.4", ket: "Distribusi dan Ekspedisi Surat" },
      { kode: "000.1.5", ket: "Penomoran Surat" },
      { kode: "000.2", ket: "Kerumahtanggaan" },
      { kode: "000.2.1", ket: "Kebersihan dan Keindahan" },
      { kode: "000.2.2", ket: "Keamanan dan Ketertiban" },
      { kode: "000.2.3", ket: "Piket dan Jadwal Petugas" },
      { kode: "000.3", ket: "Perlengkapan" },
      { kode: "000.3.1", ket: "Pengadaan Alat Tulis Kantor (ATK)" },
      { kode: "000.3.2", ket: "Pengadaan Barang / Jasa" },
      { kode: "000.3.3", ket: "Gudang dan Stok Barang" },
      { kode: "000.4", ket: "Perpustakaan" },
      { kode: "000.4.1", ket: "Pengadaan Buku" },
      { kode: "000.4.2", ket: "Katalog dan Klasifikasi Buku" },
      { kode: "000.4.3", ket: "Peminjaman dan Pengembalian Buku" },
      { kode: "000.5", ket: "Kearsipan" },
      { kode: "000.5.1", ket: "Arsip Dinamis" },
      { kode: "000.5.2", ket: "Arsip Inaktif" },
      { kode: "000.5.3", ket: "Pemusnahan Arsip" },
      { kode: "000.5.4", ket: "Penyerahan Arsip" },
      { kode: "000.6", ket: "Persandian" },
      { kode: "000.6.1", ket: "Keamanan Informasi" },
      { kode: "000.6.2", ket: "Penggunaan Kode / Sandi" },
      { kode: "000.7", ket: "Perencanaan" },
      { kode: "000.7.1", ket: "Rencana Kerja Tahunan (RKT)" },
      { kode: "000.7.2", ket: "Program Kerja Sekolah" },
      { kode: "000.8", ket: "Organisasi dan Tata Kerja" },
      { kode: "000.8.1", ket: "Struktur Organisasi Sekolah" },
      { kode: "000.8.2", ket: "Tugas Pokok dan Fungsi" },
      { kode: "000.9", ket: "Penelitian dan Pengembangan" },

      // ======================== 100 ========================
      { kode: "100", ket: "Pemerintahan dan Administrasi Resmi Sekolah" },
      { kode: "100.1", ket: "Kepala Sekolah" },
      { kode: "100.1.1", ket: "Kebijakan dan Arahan Kepala Sekolah" },
      { kode: "100.1.2", ket: "Surat Tugas Kepala Sekolah" },
      { kode: "100.1.3", ket: "Surat Rekomendasi Kepala Sekolah" },
      { kode: "100.2", ket: "Peraturan Sekolah" },
      { kode: "100.2.1", ket: "Tata Tertib Sekolah" },
      { kode: "100.2.2", ket: "Peraturan Akademik / Pembelajaran" },
      { kode: "100.2.3", ket: "Peraturan Kegiatan Ekstrakurikuler" },
      { kode: "100.2.4", ket: "Peraturan Kesiswaan" },
      { kode: "100.2.5", ket: "Peraturan Guru dan Pegawai" },
      { kode: "100.3", ket: "Hukum dan Perundang-undangan" },
      { kode: "100.3.1", ket: "Peraturan Pemerintah Terkait Pendidikan" },
      { kode: "100.3.2", ket: "Peraturan Kemendikbud" },
      { kode: "100.3.3", ket: "Peraturan Daerah / Perwali" },
      { kode: "100.3.4", ket: "Juklak, Juknis, SOP Sekolah" },
      { kode: "100.3.5", ket: "Instruksi, Edaran, dan Surat Himbauan" },
      { kode: "100.3.6", ket: "Keputusan Kepala Sekolah (SK)" },
      { kode: "100.3.7", ket: "Nota Dinas / Teguran / Peringatan" },
      { kode: "100.4", ket: "Kerja Sama dan Kemitraan Sekolah" },
      { kode: "100.4.1", ket: "MOU / Perjanjian Kerja Sama" },
      { kode: "100.4.2", ket: "Kerja Sama dengan Orang Tua / Komite" },
      { kode: "100.4.3", ket: "Kerja Sama dengan Instansi Pemerintah" },
      { kode: "100.4.4", ket: "Kerja Sama dengan Dunia Usaha / Sponsor" },
      { kode: "100.5", ket: "Administrasi Lembaga Sekolah" },
      { kode: "100.5.1", ket: "Pengajuan NPSN / Data Pokok Pendidikan" },
      { kode: "100.5.2", ket: "Laporan Kepada Dinas Pendidikan" },
      { kode: "100.5.3", ket: "Akreditasi Sekolah" },
      { kode: "100.5.4", ket: "Kurikulum Tingkat Satuan Pendidikan (KTSP)" },
      { kode: "100.6", ket: "Transparansi dan Akuntabilitas" },
      { kode: "100.6.1", ket: "Laporan Penyelenggaraan Pendidikan" },
      { kode: "100.6.2", ket: "Publikasi dan Informasi Resmi Sekolah" },
      { kode: "100.7", ket: "Komite Sekolah" },
      { kode: "100.7.1", ket: "Program Kerja Komite" },
      { kode: "100.7.2", ket: "Laporan Pertanggungjawaban Komite" },
      { kode: "100.7.3", ket: "Rapat dan Notulen Komite" },

      // ======================== 200 ========================
      { kode: "200", ket: "Kegiatan Organisasi, Hubungan Masyarakat, dan Komunikasi Sekolah" },
      { kode: "200.1", ket: "Organisasi Sekolah" },
      { kode: "200.1.1", ket: "Struktur Organisasi Sekolah" },
      { kode: "200.1.2", ket: "Tugas Pokok dan Fungsi / Tupoksi" },
      { kode: "200.1.3", ket: "Unit / Seksi / Koordinator Sekolah" },
      { kode: "200.1.4", ket: "Rapat Internal Guru dan Pegawai" },
      { kode: "200.1.5", ket: "Agenda dan Notulen Rapat" },
      { kode: "200.2", ket: "Hubungan Masyarakat (Humas)" },
      { kode: "200.2.1", ket: "Informasi Publik dan Publikasi Sekolah" },
      { kode: "200.2.2", ket: "Pengelolaan Website / Media Sosial Sekolah" },
      { kode: "200.2.3", ket: "Dokumentasi Kegiatan Sekolah" },
      { kode: "200.2.4", ket: "Pengaduan Masyarakat / Layanan Informasi" },
      { kode: "200.2.5", ket: "Kerjasama Publikasi / Media" },
      { kode: "200.3", ket: "Kerjasama dan Kemitraan Sekolah" },
      { kode: "200.3.1", ket: "Kerjasama dengan Komite Sekolah" },
      { kode: "200.3.2", ket: "Kerjasama dengan Orang Tua (Parenting)" },
      { kode: "200.3.3", ket: "Kerjasama dengan Instansi Pemerintah" },
      { kode: "200.3.4", ket: "Kerjasama dengan Dunia Usaha / Sponsor" },
      { kode: "200.3.5", ket: "Kerjasama Lingkungan / Masyarakat Sekitar" },
      { kode: "200.4", ket: "Kebijakan Strategis Sekolah" },
      { kode: "200.4.1", ket: "Musyawarah Sekolah / Perencanaan Tahunan" },
      { kode: "200.4.2", ket: "Program Kerja Tahunan & Evaluasi" },
      { kode: "200.4.3", ket: "Laporan Kepada Dinas / Kelurahan" },
      { kode: "200.5", ket: "Komunikasi Sekolah" },
      { kode: "200.5.1", ket: "Surat Edaran / Informasi Resmi" },
      { kode: "200.5.2", ket: "Pemberitahuan untuk Orang Tua" },
      { kode: "200.5.3", ket: "Panggilan Orang Tua / Koordinasi Kesiswaan" },
      { kode: "200.5.4", ket: "Publikasi Event Sekolah" },
      { kode: "200.6", ket: "Kegiatan Seremonial Sekolah" },
      { kode: "200.6.1", ket: "Upacara Hari Besar Nasional" },
      { kode: "200.6.2", ket: "Peringatan Hari Besar Keagamaan" },
      { kode: "200.6.3", ket: "Event Sekolah / Expo / Pentas Seni" },
      { kode: "200.7", ket: "Dokumentasi" },
      { kode: "200.7.1", ket: "Foto Kegiatan Sekolah" },
      { kode: "200.7.2", ket: "Video Kegiatan Sekolah" },
      { kode: "200.7.3", ket: "Publikasi di Media" },

      // ======================== 300 ========================
      { kode: "300", ket: "Keamanan, Ketertiban, dan Penanggulangan Bencana Sekolah" },
      { kode: "300.1", ket: "Ketertiban Sekolah" },
      { kode: "300.1.1", ket: "Tata Tertib Sekolah (Disiplin Guru & Siswa)" },
      { kode: "300.1.2", ket: "Pelanggaran Ringan Siswa" },
      { kode: "300.1.3", ket: "Pelanggaran Sedang & Berat Siswa" },
      { kode: "300.1.4", ket: "Pembinaan & Tindakan Disiplin" },
      { kode: "300.1.5", ket: "Pelaporan Kasus Kedisiplinan" },
      { kode: "300.2", ket: "Keamanan Lingkungan Sekolah" },
      { kode: "300.2.1", ket: "Petugas Keamanan / Satpam / Penjaga Sekolah" },
      { kode: "300.2.2", ket: "Laporan Keamanan Harian / Buku Piket" },
      { kode: "300.2.3", ket: "Pengawasan Aset Berharga" },
      { kode: "300.2.4", ket: "Pengamanan Gedung & Ruangan" },
      { kode: "300.2.5", ket: "Kejadian Luar Biasa / Insiden Keamanan" },
      { kode: "300.3", ket: "Kesiapsiagaan dan Simulasi Bencana" },
      { kode: "300.3.1", ket: "Simulasi Gempa / Kebakaran / Bencana Lain" },
      { kode: "300.3.2", ket: "Tim Siaga Bencana Sekolah (TSBS)" },
      { kode: "300.3.3", ket: "Sarana Darurat (APAR, P3K, Titik Kumpul)" },
      { kode: "300.3.4", ket: "Pelaporan Kondisi Darurat" },
      { kode: "300.4", ket: "Penanggulangan Keadaan Darurat" },
      { kode: "300.4.1", ket: "Kebakaran" },
      { kode: "300.4.2", ket: "Banjir / Longsor" },
      { kode: "300.4.3", ket: "Kecelakaan di Area Sekolah" },
      { kode: "300.4.4", ket: "Tindakan Pertolongan Pertama (P3K)" },
      { kode: "300.5", ket: "Lingkungan Aman & Sehat" },
      { kode: "300.5.1", ket: "Program Sekolah Sehat" },
      { kode: "300.5.2", ket: "Pemeriksaan Lingkungan (Jentik, Kebersihan)" },
      { kode: "300.5.3", ket: "Pemantauan Tempat Berbahaya / Zona Merah" },
      { kode: "300.6", ket: "Piket dan Penjagaan Sekolah" },
      { kode: "300.6.1", ket: "Jadwal Piket Guru" },
      { kode: "300.6.2", ket: "Jadwal Piket Siswa" },
      { kode: "300.6.3", ket: "Laporan Harian Piket" },
      { kode: "300.6.4", ket: "Piket Kebersihan / Jumat Bersih" },
      { kode: "300.7", ket: "Inspeksi dan Audit Keamanan" },
      { kode: "300.7.1", ket: "Pemeriksaan Kebersihan & Kerapihan Kelas" },
      { kode: "300.7.2", ket: "Monitoring Alat Pemadam / APAR" },
      { kode: "300.7.3", ket: "Audit Keamanan Bangunan & Sarpras" },
      { kode: "300.8", ket: "Penanganan Kriminalitas" },
      { kode: "300.8.1", ket: "Pencurian di Sekolah" },
      { kode: "300.8.2", ket: "Perusakan Fasilitas Sekolah" },
      { kode: "300.8.3", ket: "Koordinasi dengan Polsek / Babinsa" },

      // ======================== 400 ========================
      { kode: "400", ket: "Bidang Pendidikan" },
      { kode: "400.1", ket: "Pendidikan Anak Usia Dini (PAUD)" },
      { kode: "400.1.1", ket: "Pengelolaan PAUD" },
      { kode: "400.1.2", ket: "Kurikulum dan Pembelajaran PAUD" },
      { kode: "400.1.3", ket: "Bahan Ajar / Media Belajar PAUD" },
      { kode: "400.1.4", ket: "Bantuan Operasional PAUD" },
      { kode: "400.2", ket: "Pemberdayaan Perempuan & Perlindungan Anak" },
      { kode: "400.2.1", ket: "Sekolah Ramah Anak (SRA)" },
      { kode: "400.2.2", ket: "Kasus Anak / Pelaporan Kekerasan" },
      { kode: "400.3", ket: "Pendidikan (Umum)" },
      { kode: "400.3.1", ket: "Kebijakan Pendidikan" },
      { kode: "400.3.2", ket: "Pendidikan Kesetaraan / PKBM" },
      { kode: "400.3.3", ket: "Program Pendidikan Masyarakat" },
      { kode: "400.3.3.1", ket: "Bantuan Pendidikan Masyarakat" },
      { kode: "400.3.3.2", ket: "Pelatihan & Kegiatan Pendidikan Masyarakat" },
      { kode: "400.3.3.3", ket: "Lomba dan Penghargaan Pendidikan Masyarakat" },
      { kode: "400.3.5", ket: "Pendidikan Dasar (SD & SMP)" },
      { kode: "400.3.5.1", ket: "Kurikulum dan Bahan Ajar SD" },
      { kode: "400.3.5.1.1", ket: "Modul Ajar / RPP / Silabus SD" },
      { kode: "400.3.5.1.2", ket: "Media Pembelajaran SD" },
      { kode: "400.3.5.2", ket: "Bantuan Sekolah / BOS / DAK SD" },
      { kode: "400.3.5.2.1", ket: "Pengajuan & Realisasi BOS" },
      { kode: "400.3.5.2.2", ket: "Laporan Pertanggungjawaban BOS" },
      { kode: "400.3.5.3", ket: "Pelatihan / Bimtek Guru SD" },
      { kode: "400.3.5.4", ket: "Lomba, Festival, dan Penghargaan Siswa SD" },
      { kode: "400.3.5.4.1", ket: "Lomba Akademik (MTK, IPA, Literasi)" },
      { kode: "400.3.5.4.2", ket: "Lomba Non-Akademik (Seni, Olahraga)" },
      { kode: "400.3.5.5", ket: "BOS Reguler SD" },
      { kode: "400.3.5.6", ket: "Bantuan Siswa Miskin / PIP / BSM SD" },
      { kode: "400.3.6", ket: "Pendidikan Khusus / Inklusif" },
      { kode: "400.3.6.1", ket: "Kurikulum Sekolah Inklusif" },
      { kode: "400.3.6.2", ket: "Alat Bantu Pembelajaran ABK" },
      { kode: "400.3.6.3", ket: "Lomba / Kegiatan Siswa Berkebutuhan Khusus" },
      { kode: "400.3.7", ket: "Pembinaan Guru dan Tendik" },
      { kode: "400.3.7.1", ket: "Pendataan Guru" },
      { kode: "400.3.7.2", ket: "Uji Kompetensi Guru" },
      { kode: "400.3.7.3", ket: "Sertifikasi Guru" },
      { kode: "400.3.7.4", ket: "Penghargaan Guru Berprestasi" },
      { kode: "400.3.7.5", ket: "Peningkatan Kesejahteraan Guru" },
      { kode: "400.3.11", ket: "Penilaian Akademik SD" },
      { kode: "400.3.11.1", ket: "Penilaian Harian (PH)" },
      { kode: "400.3.11.2", ket: "Penilaian Tengah Semester (PTS)" },
      { kode: "400.3.11.3", ket: "Penilaian Akhir Semester (PAS)" },
      { kode: "400.3.11.4", ket: "Asesmen Sumatif" },
      { kode: "400.3.12", ket: "Penilaian Non Akademik" },
      { kode: "400.3.12.1", ket: "Data Peserta Didik / Guru / Tendik" },
      { kode: "400.3.12.2", ket: "Data Satuan Pendidikan / Proses Belajar" },
      { kode: "400.3.13", ket: "Prasarana dan Sarana Pendidikan" },
      { kode: "400.3.13.1", ket: "Prasarana Sekolah (Gedung, Kelas)" },
      { kode: "400.3.13.2", ket: "Sarana Pembelajaran" },
      { kode: "400.3.13.3", ket: "Monitoring dan Evaluasi Sarpras" },
      { kode: "400.4", ket: "Olahraga dan Kebugaran" },
      { kode: "400.4.2.1", ket: "Olahraga Pendidikan Dasar" },
      { kode: "400.5", ket: "Kepemudaan dan Pramuka" },
      { kode: "400.5.1", ket: "Kegiatan Pramuka SD" },
      { kode: "400.5.2", ket: "Pangkalan Gugus Depan SD" },
      { kode: "400.6", ket: "Kebudayaan dan Seni" },
      { kode: "400.6.1", ket: "Pentas Seni / Festival Budaya" },
      { kode: "400.6.2", ket: "Pembinaan Seni Tari / Musik / Teater" },
      { kode: "400.7", ket: "Kesehatan Sekolah" },
      { kode: "400.7.1", ket: "UKS / Kesehatan Peserta Didik" },
      { kode: "400.7.2", ket: "Pemeriksaan Kesehatan Rutin" },
      { kode: "400.7.3", ket: "Program Gizi Anak Sekolah" },

      // ======================== 500 ========================
      { kode: "500", ket: "Sarana dan Prasarana Sekolah" },
      { kode: "500.1", ket: "Inventaris Barang / Aset Sekolah" },
      { kode: "500.1.1", ket: "Pendataan Aset / Kodefikasi Barang" },
      { kode: "500.1.2", ket: "Mutasi Barang / Penghapusan Aset" },
      { kode: "500.1.3", ket: "Peminjaman Barang" },
      { kode: "500.2", ket: "Pemeliharaan Gedung & Fasilitas" },
      { kode: "500.2.1", ket: "Perbaikan Gedung / Kelas" },
      { kode: "500.2.2", ket: "Pemeliharaan Air, Listrik, Toilet" },
      { kode: "500.2.3", ket: "Renovasi dan Pembangunan" },
      { kode: "500.3", ket: "Peralatan Pembelajaran" },
      { kode: "500.3.1", ket: "Meja, Kursi, Whiteboard" },
      { kode: "500.3.2", ket: "Proyektor, Laptop, Printer" },
      { kode: "500.3.3", ket: "Alat Peraga IPA/Matematika" },
      { kode: "500.4", ket: "Lingkungan Sekolah" },
      { kode: "500.4.1", ket: "Taman Sekolah / Penghijauan" },
      { kode: "500.4.2", ket: "Kebersihan Lingkungan" },
      { kode: "500.4.3", ket: "Tempat Sampah & Pengelolaan Limbah" },

      // ======================== 600 ========================
      { kode: "600", ket: "Keamanan dan Ketertiban Umum" },
      { kode: "600.1", ket: "Perlindungan Masyarakat" },
      { kode: "600.1.1", ket: "Koordinasi dengan RT/RW" },
      { kode: "600.1.2", ket: "Koordinasi dengan Kelurahan" },
      { kode: "600.2", ket: "Kamtibmas" },
      { kode: "600.2.1", ket: "Koordinasi Polsek / Babinsa" },
      { kode: "600.2.2", ket: "Laporan Keamanan Wilayah Sekitar" },

      // ======================== 700 ========================
      { kode: "700", ket: "Komunikasi, Informasi, dan Dokumentasi" },
      { kode: "700.1", ket: "Media Komunikasi Sekolah" },
      { kode: "700.1.1", ket: "Pengelolaan Website Sekolah" },
      { kode: "700.1.2", ket: "Publikasi Media Sosial" },
      { kode: "700.1.3", ket: "Siaga Informasi / Papan Pengumuman" },
      { kode: "700.2", ket: "Hubungan Media" },
      { kode: "700.2.1", ket: "Dokumentasi Foto" },
      { kode: "700.2.2", ket: "Dokumentasi Video" },
      { kode: "700.2.3", ket: "Publikasi Berita Sekolah" },
      { kode: "700.3", ket: "Layanan Informasi Publik" },
      { kode: "700.3.1", ket: "Layanan Permohonan Informasi" },
      { kode: "700.3.2", ket: "Pengaduan Masyarakat" },

      // ======================== 800 ========================
      { kode: "800", ket: "Kepegawaian / Guru / Tendik" },
      { kode: "800.1", ket: "Pendataan Guru dan Tendik" },
      { kode: "800.1.1", ket: "Data Guru ASN / PPPK" },
      { kode: "800.1.2", ket: "Data Guru Honorer" },
      { kode: "800.1.3", ket: "Data Operator / TU" },
      { kode: "800.2", ket: "Absensi dan Disiplin Pegawai" },
      { kode: "800.2.1", ket: "Presensi Harian" },
      { kode: "800.2.2", ket: "Ketidakhadiran / Sakit / Izin" },
      { kode: "800.2.3", ket: "Laporan Disiplin PNS/Non-PNS" },
      { kode: "800.3", ket: "Cuti Pegawai" },
      { kode: "800.3.1", ket: "Cuti Tahunan" },
      { kode: "800.3.2", ket: "Cuti Sakit" },
      { kode: "800.3.3", ket: "Cuti Melahirkan" },
      { kode: "800.3.4", ket: "Cuti Penting / Dispensasi" },
      { kode: "800.4", ket: "Pengembangan Guru" },
      { kode: "800.4.1", ket: "Bimtek / Diklat / Workshop" },
      { kode: "800.4.2", ket: "Kegiatan KKG / MGMP" },
      { kode: "800.4.3", ket: "Sertifikat Pelatihan" },
      { kode: "800.5", ket: "Karier dan Sertifikasi Guru" },
      { kode: "800.5.1", ket: "Sertifikasi Pendidik" },
      { kode: "800.5.2", ket: "Kenaikan Pangkat" },
      { kode: "800.5.3", ket: "Penilaian Kinerja Guru (PKG)" },

      // ======================== 900 ========================
      { kode: "900", ket: "Keuangan Sekolah" },
      { kode: "900.1", ket: "Dana BOS / DAK / Bantuan Pendidikan" },
      { kode: "900.1.1", ket: "Rencana Kegiatan dan Anggaran Sekolah (RKAS)" },
      { kode: "900.1.2", ket: "Realisasi dan Pembukuan BOS" },
      { kode: "900.1.3", ket: "Laporan BOS Triwulan" },
      { kode: "900.2", ket: "SPJ dan Pertanggungjawaban" },
      { kode: "900.2.1", ket: "Bukti Pembelian / Nota" },
      { kode: "900.2.2", ket: "Laporan SPJ Tahunan" },
      { kode: "900.2.3", ket: "Kwitansi dan Arsip Pembayaran" },
      { kode: "900.3", ket: "Komite / Donasi / Iuran" },
      { kode: "900.3.1", ket: "Penerimaan Iuran Komite" },
      { kode: "900.3.2", ket: "Laporan Penggunaan Dana Komite" },
      { kode: "900.4", ket: "Pengelolaan Barang & Aset Keuangan" },
      { kode: "900.4.1", ket: "Pengadaan Barang Bersumber Dana BOS" },
      { kode: "900.4.2", ket: "Audit Keuangan / Pemeriksaan Inspektorat" }
    ];

    let selectedK = "";
    const romawi = ["I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII"];

    window.onload = () => {
      const d = new Date();
      $('tahunInput').value = d.getFullYear();
      romawi.forEach((r, i) => {
        const opt = document.createElement('option');
        opt.value = r; opt.text = r;
        if(i === d.getMonth()) opt.selected = true;
        $('bulanSelect').add(opt);
      });
      renderKode(kodeData);
      renderHistory();
    };

    function adjustNomor(val) {
        let n = parseInt($('nomorInput').value) + val;
        if(n < 1) n = 1;
        $('nomorInput').value = n;
    }

    function renderKode(data) {
      const list = $('kodeList');
      list.innerHTML = '';
      data.forEach(item => {
        const div = document.createElement('div');
        div.className = 'kode-item';
        div.innerHTML = `<strong>${item.kode}</strong> â€” ${item.ket}`;
        div.onclick = () => {
          selectedK = item.kode;
          document.querySelectorAll('.kode-item').forEach(el => el.classList.remove('kode-selected'));
          div.classList.add('kode-selected');
        };
        list.appendChild(div);
      });
    }

    function filterKode() {
      const val = $('searchKode').value.toLowerCase();
      const filtered = kodeData.filter(i => i.kode.includes(val) || i.ket.toLowerCase().includes(val));
      renderKode(filtered);
    }

    $('generateBtn').onclick = async () => {
      if(!selectedK) return alert("Pilih Kode Surat terlebih dahulu!");
      const ket = $('keteranganInput').value.trim();
      if(!ket) return alert("Harap isi Perihal/Keterangan!");

      const no = String($('nomorInput').value).padStart(2, '0');
      const sek = $('sekolahSelect').value;
      const bln = $('bulanSelect').value;
      const thn = $('tahunInput').value;
      const pembuat = $('pembuatInput').value || "Anonim";
      
      const nomorFull = `${selectedK}/${no}/${sek}/${bln}/${thn}`;
      const hasilSheet = `${nomorFull} â€” ${ket}`; 

      $('hasil').value = nomorFull;
      $('previewNo').textContent = nomorFull;
      $('previewKet').textContent = ket;
      $('previewArea').style.display = 'block';

      saveLocal(nomorFull, ket);
      
      $('generateBtn').disabled = true;
      $('generateBtn').innerText = "Mengirim...";
      
      try {
        await fetch(API_URL, {
          method: 'POST',
          mode: 'no-cors',
          body: JSON.stringify({
            sekolah: sek, kode: selectedK, nomor: no, bulan: bln, tahun: thn, hasil: hasilSheet, pembuat: pembuat
          })
        });
      } catch (e) { console.error(e); }
      
      $('generateBtn').disabled = false;
      $('generateBtn').innerText = "GENERATE & SIMPAN ONLINE";
      $('nomorInput').value = parseInt($('nomorInput').value) + 1;
      $('keteranganInput').value = "";
    };

    function saveLocal(nomor, ket) {
      const db = JSON.parse(localStorage.getItem(DB_NAME) || '[]');
      db.unshift({
        id: Date.now(),
        nomor: nomor,
        ket: ket,
        tgl: new Date().toISOString()
      });
      localStorage.setItem(DB_NAME, JSON.stringify(db.slice(0, 100)));
      renderHistory();
    }

    function renderHistory() {
      const db = JSON.parse(localStorage.getItem(DB_NAME) || '[]');
      const container = $('historyContainer');
      container.innerHTML = db.length ? '' : '<p class="tiny">Belum ada riwayat lokal.</p>';
      
      db.forEach(item => {
        const d = new Date(item.tgl);
        const tglIndo = d.toLocaleString('id-ID', {weekday: 'long', day:'2-digit', month:'long', year:'numeric', hour:'2-digit', minute:'2-digit'});
        
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `
          <div style="flex:1">
            <div class="tiny">${tglIndo}</div>
            <div style="font-weight:bold; font-size:15px; margin:3px 0; color:#1e293b;">${item.nomor}</div>
            <div class="perihal-text">Perihal: ${item.ket}</div>
          </div>
          <button onclick="deleteRow(${item.id})" class="btn-danger">Hapus</button>
        `;
        container.appendChild(div);
      });
    }

    window.deleteRow = (id) => {
      if(!confirm("Hapus catatan riwayat ini?")) return;
      let db = JSON.parse(localStorage.getItem(DB_NAME) || '[]');
      db = db.filter(i => i.id !== id);
      localStorage.setItem(DB_NAME, JSON.stringify(db));
      renderHistory();
    };

    window.clearAllHistory = () => {
      if(!confirm("Hapus semua riwayat di perangkat ini?")) return;
      localStorage.removeItem(DB_NAME);
      renderHistory();
    };

    async function loadOnline() {
      $('btnOnline').innerText = "Memuat...";
      try {
        const resp = await fetch(API_URL + "?t=" + Date.now());
        const data = await resp.json();
        if(Array.isArray(data)) {
          let db = JSON.parse(localStorage.getItem(DB_NAME) || '[]');
          data.reverse().forEach(row => {
            const val = row.hasil || row.Hasil;
            if(val) {
              const parts = val.split(' â€” ');
              const noOnly = parts[0];
              if(!db.find(i => i.nomor === noOnly)) {
                db.unshift({
                  id: Date.now() + Math.random(),
                  nomor: noOnly,
                  ket: parts[1] || "Data Online",
                  tgl: row.Tanggal || new Date().toISOString()
                });
              }
            }
          });
          localStorage.setItem(DB_NAME, JSON.stringify(db.slice(0, 150)));
          renderHistory();
          alert("Sinkronisasi Berhasil!");
        }
      } catch (e) { alert("Gagal mengambil data online."); }
      $('btnOnline').innerText = "ðŸ”„ Sinkron Online";
    }

    $('copyBtn').onclick = () => {
      const h = $('hasil').value;
      if(!h) return;
      navigator.clipboard.writeText(h);
      const originalText = $('copyBtn').innerText;
      $('copyBtn').innerText = "âœ… Berhasil!";
      setTimeout(() => $('copyBtn').innerText = originalText, 1500);
    };
  </script>
</body>
</html>
